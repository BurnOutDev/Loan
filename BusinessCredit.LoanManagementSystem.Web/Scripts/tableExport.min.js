(function(e){e.fn.extend({tableExport:function(p){function t(m,d,g,h){e(m).filter(":visible").find(d).each(function(m){if("none"!=e(this).css("display")&&"none"!=e(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(m)&&"function"===typeof h){var d=0;if("undefined"!=typeof w[g]&&0<w[g].length)for(c=0;c<=m;c++)"undefined"!=typeof w[g][c]&&(h(null,g,c),delete w[g][c],m++);h(this,g,m);if(e(this).is("[colspan]"))for(d=e(this).attr("colspan"),c=0;c<d-1;c++)h(null,g,m+c);if(e(this).is("[rowspan]")){var b=
parseInt(e(this).attr("rowspan"));for(r=1;r<b;r++)for("undefined"==typeof w[g+r]&&(w[g+r]=[]),w[g+r][m]="",c=1;c<d;c++)w[g+r][m+c]=""}}})}function H(m){!0===a.consoleLog&&console.log(m.output());if("string"==a.outputMode)return m.output();if("base64"==a.outputMode)return x(m.output());try{var d=m.output("blob");saveAs(d,a.fileName+".pdf")}catch(g){y(a.fileName+".pdf","data:application/pdf;base64,"+x(m.output()))}}function I(m,d,g){var h="";if(null!=m)if(d=u(m,d,g),m=null===d||""==d?"":d.toString(),
d instanceof Date)h=a.csvEnclosure+d.toLocaleString()+a.csvEnclosure;else if(d=a.csvEnclosure+a.csvEnclosure,h=m.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),d),0<=h.indexOf(a.csvSeparator)||/[\r\n ]/g.test(h))h=a.csvEnclosure+h+a.csvEnclosure;return h}function u(m,d,g){var h="";null!=m&&(m=e(m),h=!0===a.htmlContent?m.html().trim():m.text().trim().replace(/\u00AD/g,""),!0===a.escape&&(h=escape(h)),"function"===typeof a.onCellData&&(h=a.onCellData(m,d,g,h)));
return h}function N(a,d,g){return d+"-"+g.toLowerCase()}function E(a,d){return window.getComputedStyle?(d=d.replace(/([a-z])([A-Z])/,N),window.getComputedStyle(a,null).getPropertyValue(d)):a.currentStyle?a.currentStyle[d]:a.style[d]}function F(a,d,g){d=E(a,d).match(/\d+/);if(null!==d){d=d[0];var h=document.createElement("div");h.style.overflow="hidden";h.style.visibility="hidden";a.parentElement.appendChild(h);h.style.width=100+g;g=100/h.offsetWidth;a.parentElement.removeChild(h);return d*g}return 0}
function y(a,d){var g=document.createElement("a");if(g){document.body.appendChild(g);g.style="display: none";g.download=a;g.href=d;if(document.createEvent)null==A&&(A=document.createEvent("MouseEvents")),A.initEvent("click",!0,!1),g.dispatchEvent(A);else if(document.createEventObject)g.fireEvent("onclick");else if("function"==typeof g.onclick)g.onclick();document.body.removeChild(g)}}function x(a){var d="",g,h,b,e,f,k,l=0;a=a.replace(/\x0d\x0a/g,"\n");h="";for(b=0;b<a.length;b++)e=a.charCodeAt(b),
128>e?h+=String.fromCharCode(e):(127<e&&2048>e?h+=String.fromCharCode(e>>6|192):(h+=String.fromCharCode(e>>12|224),h+=String.fromCharCode(e>>6&63|128)),h+=String.fromCharCode(e&63|128));for(a=h;l<a.length;)g=a.charCodeAt(l++),h=a.charCodeAt(l++),b=a.charCodeAt(l++),e=g>>2,g=(g&3)<<4|h>>4,f=(h&15)<<2|b>>6,k=b&63,isNaN(h)?f=k=64:isNaN(b)&&(k=64),d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return d}var a={csvSeparator:",",csvEnclosure:'"',consoleLog:!1,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,
tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"};p=e.extend(!0,a,p);var A=null,w=[];if("csv"==a.type||"txt"==a.type){var f="",n=0;e(this).find("thead").first().find(a.theadSelector).each(function(){f+="\n";t(this,"th,td",n,function(m,d,g){f+=I(m,d,g)+a.csvSeparator});n++;f=e.trim(f);f=e.trim(f).substring(0,f.length-1)});e(this).find("tbody").first().find(a.tbodySelector).each(function(){trData=
"";t(this,"td",n,function(m,d,g){trData+=I(m,d,g)+a.csvSeparator});trData.length>a.csvSeparator.length&&(f+="\n"+trData);n++;f=e.trim(f).substring(0,f.length-1)});f+="\n";!0===a.consoleLog&&console.log(f);if("string"==a.outputMode)return f;if("base64"==a.outputMode)return x(f);try{var v=new Blob([("csv"==a.type?"\ufeff":"")+f],{type:"text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8"});saveAs(v,a.fileName+"."+a.type)}catch(O){y(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8,"+
("csv"==a.type?"\ufeff":"")+encodeURIComponent(f))}}else if("sql"==a.type){n=0;f="INSERT INTO `"+a.tableName+"` (";e(this).find("thead").first().find(a.theadSelector).each(function(){t(this,"th,td",n,function(a,d,g){f+="'"+u(a,d,g)+"',"});n++;f=e.trim(f);f=e.trim(f).substring(0,f.length-1)});f+=") VALUES ";e(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";t(this,"td",n,function(a,d,g){trData+="'"+u(a,d,g)+"',"});3<trData.length&&(f+="("+trData,f=e.trim(f).substring(0,f.length-
1),f+="),");n++});f=e.trim(f).substring(0,f.length-1);f+=";";!0===a.consoleLog&&console.log(f);if("string"==a.outputMode)return f;if("base64"==a.outputMode)return x(f);try{v=new Blob([f],{type:"text/plain;charset=utf-8"}),saveAs(v,a.fileName+".sql")}catch(P){y(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(f))}}else if("json"==a.type){var J=[];e(this).find("thead").first().find(a.theadSelector).each(function(){var a=[],d=0;t(this,"th,td",d,function(d,b,e){a.push(u(d,b,
e))});J.push(a);d++});var K=[];e(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=[];t(this,"td",n,function(d,g,b){a.push(u(d,g,b))});0<a.length&&(1!=a.length||""!=a[0])&&K.push(a);n++});p=[];p.push({header:J,data:K});var b=JSON.stringify(p);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;p=x(b);if("base64"==a.outputMode)return p;try{v=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(v,a.fileName+".json")}catch(Q){y(a.fileName+".json","data:application/json;charset=utf-8;base64,"+
p)}}else if("xml"==a.type){var n=0,q='<?xml version="1.0" encoding="utf-8"?>',q=q+"<tabledata><fields>";e(this).find("thead").first().find(a.theadSelector).each(function(){t(this,"th,td",n,function(a,d,g){q+="<field>"+u(a,d,g)+"</field>"});n++});var q=q+"</fields><data>",B=1;e(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=1,d="";t(this,"td",n,function(g,b,e){d+="<column-"+a+">"+u(g,b,e)+"</column-"+a+">";a++});"<column-1></column-1>"!=d&&(q+='<row id="'+B+'">'+d+"</row>",
B++);n++});q+="</data></tabledata>";!0===a.consoleLog&&console.log(q);if("string"==a.outputMode)return q;p=x(q);if("base64"==a.outputMode)return p;try{v=new Blob([q],{type:"application/xml;charset=utf-8"}),saveAs(v,a.fileName+".xml")}catch(R){y(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+p)}}else if("excel"==a.type||"doc"==a.type){var n=0,k="<table>";e(this).find("thead").first().find(a.theadSelector).each(function(){k+="<tr>";t(this,"th,td",n,function(b,d,g){if(null!=b){k+="<td style='";
for(var h in a.excelstyles)a.excelstyles.hasOwnProperty(h)&&(k+=a.excelstyles[h]+": "+e(b).css(a.excelstyles[h])+";");k+="'>"+u(b,d,g)+"</td>"}});n++;k+="</tr>"});B=1;e(this).find("tbody").first().find(a.tbodySelector).each(function(){k+="<tr>";t(this,"td",n,function(b,d,g){if(null!=b){k+="<td style='";for(var h in a.excelstyles)a.excelstyles.hasOwnProperty(h)&&(k+=a.excelstyles[h]+": "+e(b).css(a.excelstyles[h])+";");e(b).is("[colspan]")&&(k+="' colspan='"+e(b).attr("colspan"));e(b).is("[rowspan]")&&
(k+="' rowspan='"+e(b).attr("rowspan"));k+="'>"+u(b,d,g)+"</td>"}});B++;n++;k+="</tr>"});a.displayTableName&&(k+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+u(e("<p>"+a.tableName+"</p>"))+"</td></tr>");k+="</table>";!0===a.consoleLog&&console.log(k);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+a.type+'; charset=UTF-8">';
b=b+'<meta http-equiv="content-type" content="application/'+("excel"==a.type?"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"==a.type&&(b+="\x3c!--[if gte mso 9]>",b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+="</xml>",b+="<![endif]--\x3e");
b+="</head>";b+="<body>";b+=k;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;p=x(b);if("base64"==a.outputMode)return p;var L="excel"==a.type?"xls":"doc";try{v=new Blob([b],{type:"application/vnd.ms-"+a.type}),saveAs(v,a.fileName+"."+L)}catch(S){y(a.fileName+"."+L,"data:application/vnd.ms-"+a.type+";base64,"+p)}}else if("png"==a.type)html2canvas(e(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var d=atob(b),g=new ArrayBuffer(d.length),e=new Uint8Array(g),f=0;f<d.length;f++)e[f]=
d.charCodeAt(f);try{var k=new Blob([g],{type:"image/png"});saveAs(k,a.fileName+".png")}catch(l){y(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type)if(!1===a.jspdf.autotable){p={dim:{w:F(e(this).first().get(0),"width","mm"),h:F(e(this).first().get(0),"height","mm")},pagesplit:!1};var G=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);G.addHTML(e(this).first(),a.jspdf.margins.left,a.jspdf.margins.top,p,function(){H(G)});delete G}else{var l=a.jspdf.autotable.tableExport;
if("string"===typeof a.jspdf.format&&"bestfit"==a.jspdf.format.toLowerCase()){var C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},D="",z="",M=0;e(this).filter(":visible").each(function(){if("none"!=e(this).css("display")){var a=F(e(this).get(0),"width","pt");if(a>M){a>C.a0[0]&&(D="a0",z="l");for(var b in C)C[b][1]>a&&(D=b,z="l",C[b][0]>a&&(z="p"));M=a}}});a.jspdf.format=""==D?"a4":D;a.jspdf.orientation=""==z?"w":z}l.doc=new jsPDF(a.jspdf.orientation,
a.jspdf.unit,a.jspdf.format);e(this).filter(":visible").each(function(){if("none"!=e(this).css("display")){var b=0,d={};l.columns=[];l.rows=[];if("function"===typeof l.onTable&&!1===l.onTable(e(this),a))return!0;Object.keys(a.jspdf.autotable).forEach(function(b){d[b]=a.jspdf.autotable[b]});d.margins={};e.extend(!0,d.margins,a.jspdf.margins);"function"!==typeof d.renderCell&&(d.renderCell=function(a,b,d,e,f,k,m,l){var n=l.tableExport.doc;f=l.tableExport.columns[f];var p=0;n.setFillColor(0===m%2?245:
255);n.setTextColor(50);n.rect(a,b,d,e,"F");b+=l.lineHeight/2+n.autoTableTextHeight()/2-2.5;"right"==f.style.align?p=d-n.getStringUnitWidth(""+k)*n.internal.getFontSize()-l.padding:"center"==f.style.align&&(p=(d-n.getStringUnitWidth(""+k)*n.internal.getFontSize())/2);p<l.padding&&(p=l.padding);n.text(k,a+p,b)});e(this).find("thead").find(a.theadSelector).each(function(){t(this,"th,td",b,function(a,b,d){a={title:u(a,b,d),key:d,style:{align:E(a,"text-align"),bcolor:E(a,"background-color")}};l.columns.push(a)});
b++});e(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];t(this,"td",b,function(b,d,e){a.push(u(b,d,e))});b++;l.rows.push(a)});if("function"===typeof l.onBeforeAutotable)l.onBeforeAutotable(e(this),l.columns,l.rows,d);l.doc.autoTable(l.columns,l.rows,d);if("function"===typeof l.onAfterAutotable)l.onAfterAutotable(e(this),d);a.jspdf.autotable.startY=l.doc.autoTableEndPosY()+d.margins.top}});H(l.doc);l.columns.length=0;l.rows.length=0;delete l.doc;l.doc=null}return this}})})(jQuery);